## configure security group policy
# - include: sg_configure.yml
#
## Install Datadog Agent
# - include: datadog.yml
#
## begin with databases:
- include: consul.yml
- include: vault.yml
- include: rabbitmq.yml
- include: redis.yml
- include: registry.yml

# Not sure if we have to run this
#- include: consul-values.yml -e write_values="true"
# - include: consul-services.yml
# - include: vault-values.yml -e write_values="true"

# Docks Services
- include: palantiri.yml git_branch="{{ palantiri_branch }}" -t deploy
- include: sauron.yml git_branch="{{ sauron_branch }}" -t deploy
- include: shiva.yml git_branch="{{ astral_branch }}" -t deploy
- include: khronos.yml git_branch="{{ khronos_branch }}" -t deploy
- include: swarm-manager.yml

# Main
- include: api.yml git_branch="{{ api_branch }}" -t deploy
- include: big-poppa.yml git_branch="{{ big_poppa_branch }}" -t deploy
- include: cream.yml git_branch="{{ cream_branch }}" -t deploy
- include: web.yml git_branch="{{ angular_branch }}" -t deploy

# Networking services
- include: detention.yml git_branch="{{ detention_branch }}" -t deploy
- include: link.yml git_branch="{{ link_branch }}" -t deploy
- include: navi.yml git_branch="{{ navi_branch }}" -t deploy

# Proxies
- include: registrator-api.yml # Only one of these is needed
- include: single-host-proxy.yml
- include: github-varnish.yml

# Other
- include: optimus.yml git_branch="{{ optimus_branch }}" -t deploy
- include: drake.yml git_branch="{{ drake_branch }}" -t deploy
- include: pheidi.yml git_branch="{{ pheidi_branch }}" -t deploy

# Secondary services and configuration
# run with: `--extra-vars "@current_versions.yml"`
