name: sauron
app_name: "{{ name }}"
security_groups: "{{ sg_sauron }}"

# copy certs into docker image:
docker_client_certs: true

container_image: "registry.runnable.com/runnable/{{ name }}"
container_tag: "{{ git_branch }}"
repo: "git@github.com:CodeNow/{{ name }}.git"
node_version: "4.2.2"
npm_version: "2.14.7"

weave_path: "/bin/weave"
docker_path: "/bin/docker"

dockerfile_pre_install_commands: [
  "curl -L https://get.docker.com/builds/Linux/x86_64/docker-1.6.2 -o {{ docker_path }}",
  "chmod a+x {{ docker_path }}",
  "curl -L https://github.com/weaveworks/weave/releases/download/v1.5.0/weave -o {{ weave_path }}",
  "chmod a+x {{ weave_path }}"
]

dockerfile_environment: |
  ENV CONSUL_HOST {{ consul_host_address }}:{{ consul_api_port }}
  ENV DATADOG_HOST {{ datadog_host_address }}
  ENV DATADOG_PORT {{ datadog_port }}
  ENV LOGGLY_TOKEN "{{ loggly_token }}"
  ENV NODE_ENV "{{ node_env }}"
  ENV RABBITMQ_HOSTNAME "{{ rabbit_host_address }}"
  ENV RABBITMQ_PASSWORD "{{ rabbit_password }}"
  ENV RABBITMQ_PORT "{{ rabbit_port }}"
  ENV RABBITMQ_USERNAME "{{ rabbit_username }}"
  ENV ROLLBAR_KEY {{ sauron_rollbar_key }}
  ENV SWARM_HOSTNAME {{ swarm_host_address }}
  ENV SWARM_PORT {{ swarm_master_port }}
  ENV WEAVE_PATH {{ weave_path }}

container_run_opts: >
  -h {{ name }}
  -d
