docker_config: docks
deploy_user: ubuntu
error_mail: ops+docks_iptables@runnable.com
psad_apply: true

ethernet: 
  private: 
    ip_address: "{{ansible_eth0.ipv4.address}}"
    name: "eth0"

# Iptables Rules
# TODO this needs some tuning, but we will start simply with this and tune it per-service environment.
iptables_rule:
  - '-I FORWARD -s 172.17.42.1/16 -m state --state NEW -m hashlimit --hashlimit-above 10/sec --hashlimit-burst 10 --hashlimit-mode srcip --hashlimit-name psad1 -j LOG --log-prefix=iptables:'
  - '-I INPUT -p tcp --dport ssh -j ACCEPT'
  - '-I FORWARD -s 172.0.0.0/8 -d 172.0.0.0/8 -j DROP'
  - '-I FORWARD -s 172.0.0.0/8 -d  10.0.0.0/8 -m state --state NEW -j DROP'
  - '-I INPUT -s 172.0.0.0/8 -d  10.0.0.0/8 -m state --state NEW -j DROP'
  - '-A INPUT -i {{ ethernet.private.name }} -m state --state NEW -j DROP'
  - '-I INPUT -p icmp --icmp-type echo-request -m state --state ESTABLISHED -j REJECT'

# Sysctl rules
sysctl_rule:
  - '# Disable ping'
  - 'net.ipv4.icmp_echo_ignore_all=1'
  - '# Turn on Source Address Verification in all interfaces to prevent some'
  - '# spoofing attacks'
  - 'net.ipv4.conf.default.rp_filter=1'
  - 'net.ipv4.conf.all.rp_filter=1'
  - '# Do not accept IP source route packets (we are not a router)'
  - 'net.ipv4.conf.default.accept_source_route=0'
  - 'net.ipv4.conf.all.accept_source_route=0'
  - 'net.ipv6.conf.default.accept_source_route=0'
  - 'net.ipv6.conf.all.accept_source_route=0'
  - '# Disable ICMP redirects. ICMP redirects are rarely used but can be used in'
  - '# MITM (man-in-the-middle) attacks. Disabling ICMP may disrupt legitimate'
  - '# traffic to those sites.'
  - 'net.ipv4.conf.default.accept_redirects=0'
  - 'net.ipv4.conf.all.accept_redirects=0'
  - 'net.ipv6.conf.default.accept_redirects=0'
  - 'net.ipv6.conf.all.accept_redirects=0'
  - '# Ignore bogus ICMP errors'
  - 'net.ipv4.icmp_echo_ignore_broadcasts=1'
  - 'net.ipv4.icmp_ignore_bogus_error_responses=1'
  - 'net.ipv4.icmp_echo_ignore_all=0'
  - '# Do not log Martian Packets (impossible packets)'
  - 'net.ipv4.conf.default.log_martians=0'
  - 'net.ipv4.conf.all.log_martians=0'
  - '# Change to 1 to enable TCP/IP SYN cookies This disables TCP Window Scaling'
  - '# (http://lkml.org/lkml/2008/2/5/167)'
  - 'net.ipv4.tcp_syncookies=0'
  - 'net.ipv4.tcp_max_syn_backlog = 2048'
  - 'net.ipv4.tcp_synack_retries = 2'
  - 'net.ipv4.tcp_syn_retries = 5'

script_temp_path: "/tmp/iptables_update.sh"
docker_network: "172.17.0.0/16"

#iptables_rule: 
#  - '-I FORWARD -s 172.0.0.0/8 -d 10.0.0.0/8 -j DROP'
#  - '-I FORWARD -s 172.0.0.0/8 -d 172.0.0.0/8 -j DROP'

psad: 
  channel: "#docks-iptables"
  username: "PSAD"
psad_hook_url: "https://hooks.slack.com/services/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"
psad_script_folder: "/home/{{deploy_user}}/devOps/psad_script"

iptable_pattern: "iptables:"
iptable_log_file: "/var/log/iptables"
