---
name: docs

container_image: registry.runnable.com/runnable/{{ name }}
container_tag: "{{ git_branch }}"
repo: git@github.com:Runnable/documentation.git
hosted_ports: [ "3000" ]
node_version: 6.9.1
npm_version: 3.10.8

dockerfile_enviroment: [
  "NPM_TOKEN {{ npm_token }}"
]
dockerfile_pre_install_commands: [
   'echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" > .npmrc'
]

dockerfile_post_install_commands:
- apt-get update && apt-get install -y supervisor
- npm run build

container_envs: >
  -e DOMAIN={{ docs_subdomain }}.{{ domain }}
  -e LOG_ENVIRONMENT={{ node_env }}
  -e LOG_LEVEL=trace
  -e NODE_ENV=production
  -e RUNNABLE_DOMAIN={{ domain }}
  -e USER_CONTENT_DOMAIN={{ user_content_domain }}

container_run_opts: >
  -h {{ name }}
  -d
  -P
  -v /var/log:/var/log:rw
  {{ container_envs }}

container_run_args: bash -c "supervisord --configuration supervisord.conf && sleep 10 && tail -n 100 -qf /tmp/*std*.log /tmp/supervisord.log"
