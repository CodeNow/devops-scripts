---
- hosts: registry
  tasks:
    - name: gather facts about the registry
      tags: "deploy"
      setup: filter=*
- hosts: redis
  tasks:
    - name: gather facts about redis
      tags: "deploy"
      setup: filter=*
- hosts: datadog
  tasks:
    - name: gather facts about datadog hosts
      tags: "deploy"
      setup: filter=*
- hosts: mongodb
  tasks:
    - name: gather facts about mongo hosts
      tags: "deploy"
      setup: filter=*

- hosts: api
  roles:
  - { role: notify, tags: "notify" }
  - { role: redis_key, tags: ["setup", "redis_key"] }
  - { role: builder, tags: "build" }
  - { role: container_start, tags: "deploy" }
