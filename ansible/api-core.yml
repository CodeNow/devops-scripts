---
- hosts: mongodb
- hosts: navi
- hosts: redis
- hosts: rabbitmq
- hosts: big-poppa_group
- hosts: cream_group
- hosts: github-varnish
- hosts: swarm-manager
- hosts: consul

- hosts: builder
  vars_files:
    - group_vars/alpha-api-base.yml
    - group_vars/alpha-api.yml
    - group_vars/ec2_sg.yml
  roles:
  - { role: notify, rollbar_token: "{{ api_rollbar_key }}", tags: [ notify ] }
  - { role: docker_client }
  - { role: tls-client, tls_service: mongodb }
  - { role: builder }
  - { role: push }

- include: aws/api-core.yml
- include: deploy/api-core.yml
