---
- hosts: mongodb
- hosts: navi
- hosts: rabbitmq
- hosts: redis
- hosts: big-poppa
- hosts: cream
- hosts: github-varnish
- hosts: swarm-manager
- hosts: consul

- hosts: builder
  vars_files:
    - group_vars/alpha-api-base.yml
    - group_vars/alpha-api.yml
  roles:
  - role: notify
    rollbar_token: "{{ api_rollbar_key }}"
    tags: [ notify ]

  - role: builder
    tags: [ build ]

  - role: docker_client

  - role: tls-client
    tags: [ tls ]
    tls_service: mongodb

  - role: push
    tags: [ push ] 

- hosts: api
  - role: datadog
    tags: [ datadog ]

  - role: pull_start
    number_of_containers: "{{ ansible_processor_cores }}"
