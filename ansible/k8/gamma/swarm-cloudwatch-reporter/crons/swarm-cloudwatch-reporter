apiVersion: batch/v2alpha1
kind: CronJob
metadata:
  name: swarm-cloudwatch-reporter
spec:
  schedule: "*/5 * * * *"
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      activeDeadlineSeconds: 600
      template:
        spec:
          volumes:
            - name: swarm-cloudwatch-reporter-docker-ssl-certs
              configMap:
                name: swarm-cloudwatch-reporter-docker-ssl-certs
          imagePullSecrets:
            - name: runnable-kubernetes-pull-secret
          restartPolicy: Never
          containers:
            - name: swarm-cloudwatch-reporter
              volumeMounts:
                - name: swarm-cloudwatch-reporter-docker-ssl-certs
                  mountPath: /etc/ssl/docker
              image: quay.io/runnable/furry-cactus:v2.0.0
              env:
                - name: DATADOG_HOST
                  valueFrom:
                    fieldRef:
                      fieldPath: spec.nodeName
                - name: DATADOG_PORT
                  value: "8125"
                - name: AWS_ACCESS_KEY
                  value: "AKIAIWRXWZ4P3MIMY3LA"
                - name: AWS_SECRET_KEY
                  value: "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"
                - name: DOCKER_CERT_PATH
                  value: "/etc/ssl/docker"
                - name: ENVIRONMENT
                  value: "gamma"
                - name: SWARM_HOSTNAME
                  value: "swarm"
                - name: SWARM_PORT
                  value: "2375"
              args:
                - npm
                - start
