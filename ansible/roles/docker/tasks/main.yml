---
- name: check if docker is installed
  shell: "[ -f /usr/bin/docker  ] && echo 'Found' || echo ''"
  register: docker_installed
  changed_when: docker_installed.stdout != 'Found'

- name: install apt-transport-https
  when: docker_installed.changed
  sudo: yes
  apt:
    pkg="apt-transport-https"
    state=present
    update_cache=yes

- name: add docker apt key
  when: docker_installed.changed
  sudo: yes
  action: apt_key url=https://get.docker.io/gpg state=present

- name: add docker repository
  when: docker_installed.changed
  sudo: yes
  action: apt_repository repo='deb https://get.docker.com/ubuntu docker main' state=present update_cache=yes

- name: install docker
  when: docker_installed.changed
  sudo: yes
  action: apt pkg="{{ docker_package_name }}" state=present update_cache=yes

- name: copy docker config file
  sudo: yes
  template:
    src={{ docker_config }}
    dest=/etc/default/docker
  register: copied_config
  tags: genDockerConfig

- name: restart docker
  when: copied_config.changed and restart is defined
  command: sudo service docker restart
