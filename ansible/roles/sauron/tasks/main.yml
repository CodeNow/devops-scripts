---
- name: reset weave
  command: "{{ weave_path }} reset"
  when: weave_reset is defined
  sudo: yes

- name: install weave
  get_url: url=https://github.com/weaveworks/weave/releases/download/v1.1.2/weave
    dest="{{ weave_path }}"
    mode=0777
    force=yes
  sudo: yes
  register: weave_install

- name: setup weave
  command: "{{ weave_path }} setup"
  when: weave_install.changed
  sudo: yes

- name: stop previous weave
  shell: "docker kill `docker ps | grep weave | awk '{print $1}'` || echo"
  when: weave_install.changed
  sudo: yes
  notify:
    - restart service {{ app_name }}