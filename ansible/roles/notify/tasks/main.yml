---
- name: send hipchat message for deploy
  hipchat:
    token=c33f7a2f84b34150e930158c1cf674
    room="{{ item }}"
    msg="{{ deploy_message }}"
  with_items:
    - "{{hipchat_rooms}}"
    - "{{extra_rooms|default([])}}"
  notify:
    - notify end

- name: get the username running the deploy
  local_action: command whoami
  register: local_username
  delegate_to: 127.0.0.1

- name: send rollbar message for deploy
  rollbar_deployment:
    token={{rollbar_token}}
    environment={{node_env}}
    revision={{git_branch}}
    rollbar_user={{local_username.stdout}}
  when: rollbar_token is defined and node_env is defined and git_branch is defined