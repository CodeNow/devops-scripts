---
- name: copy config file
  sudo: yes
  template:
    src=upstart.conf
    dest=/etc/init/{{ app_name }}.conf
    backup=yes
  notify:
    - restart service {{ app_name }}

- name: create {{ app_name }} repository dir
  sudo: yes
  file:
    path=/opt/runnable/{{ app_name }}
    state=directory
    owner={{ ansible_env.USER }}

- name: pull the git repository
  git:
    repo={{ app_repo }}
    dest=/opt/runnable/{{ app_name }}
    version={{ git_branch }}
    update=yes
    accept_hostkey=True
  notify:
    - npm install {{ app_name }}
    - restart service {{ app_name }}
