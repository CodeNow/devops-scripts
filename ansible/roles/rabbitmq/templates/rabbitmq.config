apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ name }}-conf
data:
  rabbitmq.config: |
    [
      {rabbit,
        [
          {default_vhost,       <<"/">>},
          {default_user,        <<"{{ rabbit_username }}">>},
          {default_pass,        <<"{{ rabbit_password }}">>},
          {default_permissions, [<<".*">>, <<".*">>, <<".*">>]}
        ]},
      {rabbitmq_management,
        [
          {load_definitions, "/etc/rabbitmq/schema.json"}
        ]}
    ].

  rabbit.json: |
    {
      "rabbit_version": "3.5.3",
      "users": [
        {
          "name": "{{ rabbit_username }}",
          "password_hash": "a9SjtJGMhoit1OtDJkkx7FhKAW4=",
          "tags": "administrator"
        }
      ],
      "vhosts": [
        {
          "name": "/"
        }
      ],
      "permissions": [
        {
          "user": "{{ rabbit_username }}",
          "vhost": "/",
          "configure": ".*",
          "write": ".*",
          "read": ".*"
        }
      ],
      "parameters": [],
      "policies": [],
      "queues": [],
      "exchanges": [
        {
          "name": "organization.integration.prbot.disabled",
          "vhost": "/",
          "type": "fanout",
          "durable": true,
          "auto_delete": false,
          "internal": false,
          "arguments": {}
        },
        {
          "name": "routing.cache.invalidated",
          "vhost": "/",
          "type": "fanout",
          "durable": true,
          "auto_delete": false,
          "internal": false,
          "arguments": {}
        },
        {
          "name": "asg.update.requested",
          "vhost": "/",
          "type": "fanout",
          "durable": true,
          "auto_delete": false,
          "internal": false,
          "arguments": {}
        },
        {
          "name": "organization.disallowed",
          "vhost": "/",
          "type": "fanout",
          "durable": true,
          "auto_delete": false,
          "internal": false,
          "arguments": {}
        }
      ],
      "bindings": []
    }
