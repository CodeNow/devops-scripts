---
- name: create scripts directory
  sudo: yes
  file: path=/opt/scripts state=directory

- name: put script in place
  sudo: yes
  copy:
    src={{ item }}.sh
    dest=/opt/scripts/{{ item }}.sh
    mode=0500
  with_items:
    - docker_rss
    - docker_log_lines
    - docker_proc_status

- name: put cron in place
  sudo: yes
  cron:
    name="{{ item.name }}"
    minute={{ item.minutes }}
    state={{ item.state | default("present") }}
    job="/opt/scripts/{{ item.name }}.sh > /dev/null"
  with_items:
    - { name: docker_rss, minutes: '*' }
    - { name: docker_log_lines, minutes: '*/5', state: absent }
    - { name: docker_proc_status, minutes: '*' }
