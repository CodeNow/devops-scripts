---
#file roles/ssh-keys/tasks/main.yml

- name: iptables restore in rc.local
  lineinfile:
    dest=/etc/rc.local
    line="iptables-restore < /etc/firewall.conf"
    state=present
    regexp=".+ \/etc\/firewall\.conf"
    insertbefore="exit 0"
  sudo: yes

- name: Place temp script file for iptables update
  template: src=iptables_apply_rule.sh.j2 dest={{ script_temp_path }} owner=root group=root mode=500
  sudo: yes

- name: Apply iptables
  shell: "{{ script_temp_path }} '{{ item }}'"
  with_items: iptables_rule
  sudo: yes

- name: update /etc/firewall.conf so that it load on system startup
  template: src=firewall.conf.j2 dest=/etc/firewall.conf owner=root group=root mode=500
  sudo: yes
