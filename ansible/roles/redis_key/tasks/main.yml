---
- name: check keys
  command: sudo docker run --rm redis redis-cli -h {% for host in groups['redis'] %}{% if loop.first %}{{ hostvars[host]['ansible_default_ipv4']['address'] }}{% endif %}{% endfor %} LLEN {{redis_key}}
  register: key_length
  changed_when: key_length.stdout == "0"

- name: create key if not exist
  command: sudo docker run --rm redis redis-cli -h {% for host in groups['redis'] %}{% if loop.first %}{{ hostvars[host]['ansible_default_ipv4']['address'] }}{% endif %}{% endfor %} RPUSH {{redis_key}} {{name}} {{name}}
  when: key_length.changed
