---
- name: npm install
  tags: deploy
  npm:
    path=/opt/runnable/image-builder
    state=latest

- name: build the image-builder
  tags: deploy
  command: sudo docker build --build-arg githubDomain={{ github_domain }} --no-cache --tag="registry.runnable.com/{{ image_builder_docker_namespace }}:{{ git_branch }}" /opt/runnable/image-builder

- name: push image-builder
  tags: deploy
  run_once: true
  command: sudo docker push "registry.runnable.com/{{ image_builder_docker_namespace }}:{{ git_branch }}"
  when: dock is not defined
