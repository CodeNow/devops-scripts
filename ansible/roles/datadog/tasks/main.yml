---
- name: add datadog source
  sudo: yes
  lineinfile:
    state=present
    create=yes
    dest=/etc/apt/sources.list.d/datadog.list
    line='deb http://apt.datadoghq.com/ stable main'

- name: add datadog apt key
  sudo: yes
  apt_key:
    keyserver=keyserver.ubuntu.com
    id=C7A7DA52

- name: install datadog via apt
  sudo: yes
  apt:
    update_cache=yes
    name=datadog-agent
    state=present

- name: copy datadog example config into place
  sudo: yes
  command: cp datadog.conf.example datadog.conf
    chdir=/etc/dd-agent
    creates=/etc/dd-agent/datadog.conf

- name: set API key for datadog
  sudo: yes
  lineinfile: "
    state=present
    dest=/etc/dd-agent/datadog.conf
    regexp='^api_key:.*$'
    line='api_key: 6488896fe0c811965ef233b96809d70d'"

- name: (re)start datadog
  sudo: yes
  service:
    name=datadog-agent
    state=restarted
  
