---
- fail: msg="value tokens need to be defined for this role"
  tags: vault_files
  when: vault_auth_token is not defined or vault_token_01 is not defined or vault_token_02 is not defined or vault_token_03 is not defined

- name: create vault auth directory
  tags: vault_files
  become: true
  file:
    dest="/opt/runnable/dock-init/consul-resources/vault/{{ node_env }}"
    state=directory
    mode="0711"

- name: copy vault auth files
  tags: vault_files
  become: true
  copy:
    dest="/opt/runnable/dock-init/consul-resources/vault/{{ node_env }}/{{ item.file_name }}"
    content="{{ item.value }}"
    mode="0400"
  with_items:
  - { file_name: 'auth-token', value: "{{ vault_auth_token }}" }
  - { file_name: 'user-vault-auth-token', value: "{{ dock_vault_user_creation_access_token }}" }
  - { file_name: 'token-01', value: "{{ vault_token_01 }}" }
  - { file_name: 'token-02', value: "{{ vault_token_02 }}" }
  - { file_name: 'token-03', value: "{{ vault_token_03 }}" }
