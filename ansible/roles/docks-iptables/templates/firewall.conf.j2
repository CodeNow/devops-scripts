# Generated by iptables-save v1.4.21 on Tue Jan  3 22:12:31 2017
# This should be run before docker starts
*filter

:INPUT ACCEPT [0:0]
# drop pings
-A INPUT -p icmp --icmp-type echo-request -m state --state ESTABLISHED -j DROP
# prevent containers from talking to host
-A INPUT -s {{ docker_network }} -d 10.0.0.0/8 -m state --state NEW -j DROP

:FORWARD ACCEPT [0:0]
# allow aws DNS server queries (must be first)
-I FORWARD -s {{ docker_network }} -d {{ ansible_dns.nameservers[0] }} -j ACCEPT
# drop all local container to container traffic
-A FORWARD -s {{ docker_network }} -d {{ docker_network }} -j DROP
# log container traffic for PSAD
-A FORWARD -s {{ docker_network }} -j LOG
# drop all new traffic from container ip to runnable infra
-A FORWARD -s {{ docker_network }} -d 10.0.0.0/8 -m state --state NEW -j DROP

:OUTPUT ACCEPT [0:0]
# drop all new traffic from container to runnable infra
-A OUTPUT -s {{ docker_network }} -d 10.0.0.0/8 -m state --state NEW -j DROP

COMMIT
