---
- name: make sure cert directory is in place
  tags: [ certs ]
  become: true
  file:
    dest: /etc/ssl/certs/{{ user_content_domain }}
    state: directory

- name: put certs in place
  tags: [ certs ]
  become: true
  copy:
    src: "{{ user_content_domain }}/{{ item }}"
    dest: /etc/ssl/certs/{{ user_content_domain }}/{{ item }}
    mode: 0400
    owner: root
    group: root
  with_items:
  - ca.pem
  - key.pem
  - cert.pem

- name: create chained cert
  tags: [ certs ]
  become: true
  shell: >
    cat
    /etc/ssl/certs/{{ user_content_domain }}/cert.pem
    /etc/ssl/certs/{{ user_content_domain }}/ca.pem
    >
    /etc/ssl/certs/{{ user_content_domain }}/chained.pem
