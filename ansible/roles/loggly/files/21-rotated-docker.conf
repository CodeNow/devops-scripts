$WorkDirectory /var/spool/rsyslog

# Rotate per hour
$template RotateHourly_docker,"/var/log/runnable/%$YEAR%/%$MONTH%/%$DAY%/%$HOUR%/docker.log"
if $msg contains 'docker' and $syslogfacility-text == 'local7' then { action (type="omfile" DynaFile="RotateHourly_docker" template="RunnableJSON" dirCreateMode="0755" FileCreateMode="0644") }

# Loggly: Add a tag for docker events
$template LogglyFormat_docker,"<%pri%>%protocol-version% %timestamp:::date-rfc3339% %HOSTNAME% %app-name% %procid% %msgid% [f673760d-e0b3-4a93-a15e-2862ea074f91@41058 tag=\"runnable\" tag=\"production-epsilon\"] %msg%\n"
if $msg contains 'docker' and $syslogfacility-text == 'local7' then @@logs-01.loggly.com:6514;LogglyFormat_docker
if $msg contains 'docker' and $syslogfacility-text == 'local7' then stop
