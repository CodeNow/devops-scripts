---
- name: starting docker
  become: true
  service:
    name=docker
    state=started

- name: add runnable registry to /etc/hosts
  become: true
  blockinfile:
    dest: /etc/hosts
    insertafter: EOF
    block: |
      {{ registry_address }} registry.runnable.com

- name: pulling docker images
  become: true
  command: docker pull {{ item }}
  with_items:
    - "registry.runnable.com/runnable/image-builder:v4.2.2"
    - "swarm:1.2.5"
    - "registry:2.3.1"
    - "google/cadvisor:v0.24.1"
    - "prom/node-exporter:0.12.0"
    - "weaveworks/weaveexec:1.5.0"
    - "weaveworks/weavedb:latest"
    - "weaveworks/weave:1.5.0"
    - "node:argon"
    - "ruby:2.3"
    - "python:2.7"
    - "php:7.0-apache"
    - "runnable/mysql:5.6"
    - "runnable/postgres:9.4"
    - "runnable/mongo:3.2"

- name: stopping docker
  become: true
  service:
    name=docker
    state=stopped

- name: removing docker key file
  become: true
  file: 
    path: /etc/docker/key.json 
    state: absent

- name: removing docker pid file
  become: true
  file:
    path: /var/run/docker.pid
    state: absent
