---
- set_fact:
    ca_data: "{{ lookup('file', '{{ user_content_domain }}/ca.pem') }}"
- set_fact:
    cert_data: "{{ lookup('file', '{{ user_content_domain }}/cert.pem') }}"
- set_fact:
    key_data: "{{ lookup('file', '{{ user_content_domain }}/key.pem') }}"
- set_fact:
    chained_data: "{{ lookup('file', '{{ user_content_domain }}/chained.pem') }}"
- set_fact:
    dhparam_data: "{{ lookup('file', '{{ user_content_domain }}/dhparam.pem') }}"

- name: create cert config map
  tags: [ configure_proxy, configure_files ]
  template:
    src: certs.yml
    dest: "{{ config_maps_path }}/{{ name }}-certs"

- name: create proxy template
  tags: [ configure_proxy, configure_files ]
  template:
    src: proxy-nginx.conf
    dest: "{{ config_maps_path }}/{{ name }}-base-config"

- name: create api template
  tags: [ configure_proxy, configure_files ]
  template:
    src: navi.tmpl
    dest: "{{ config_maps_path }}/{{ name }}-navi-config"
